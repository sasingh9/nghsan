# H2 Database Configuration for Tests
spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1
spring.datasource.username=sa
spring.datasource.password=password
spring.datasource.driverClassName=org.h2.Driver
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

# Disable JMX for tests to avoid conflicts
spring.jmx.enabled=false

# Kafka Test Configuration
# The embedded broker will override the bootstrap servers automatically.
spring.kafka.bootstrap-servers=${spring.embedded.kafka.brokers}
# A group-id is still required for the placeholder resolution in @KafkaListener.
spring.kafka.consumer.group-id=test-group
app.kafka.topic.json-input=test-json-topic
app.kafka.topic.json-output=test-json-trade-details-topic

# DDL for table creation in H2
app.db.ddl.create-table=CREATE TABLE json_docs (id BIGINT AUTO_INCREMENT PRIMARY KEY, message_key VARCHAR(36) UNIQUE, data BLOB, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
app.db.ddl.create-trade-details-table=CREATE TABLE trade_details (id BIGINT AUTO_INCREMENT PRIMARY KEY, client_reference_number VARCHAR(255), fund_number VARCHAR(255), security_id VARCHAR(255), trade_date DATE, settle_date DATE, quantity DECIMAL(19, 4), price DECIMAL(19, 4), principal DECIMAL(19, 4), net_amount DECIMAL(19, 4))
app.db.ddl.create-trade-exceptions-table=CREATE TABLE trade_exceptions (id BIGINT AUTO_INCREMENT PRIMARY KEY, client_reference_number VARCHAR(255), error_type VARCHAR(20) NOT NULL, failed_trade_json BLOB, failure_reason VARCHAR(1000), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
