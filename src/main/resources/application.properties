# H2 Database Configuration
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=password
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.h2.console.enabled=true
spring.jpa.hibernate.ddl-auto=update

# Kafka Consumer Configuration
spring.kafka.consumer.bootstrap-servers=localhost:9092
spring.kafka.consumer.group-id=json-storage-group
app.kafka.topic.json-input=json-topic
app.kafka.topic.json-output=json-trade-details-topic

# Instruct Spring Boot to run as a web application (servlet-based)
spring.main.web-application-type=servlet

# DDL for table creation
app.db.ddl.create-table=CREATE TABLE json_docs (id INT AUTO_INCREMENT PRIMARY KEY, message_key VARCHAR(36) UNIQUE, data BLOB, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
app.db.ddl.create-trade-details-table=CREATE TABLE trade_details (id INT AUTO_INCREMENT PRIMARY KEY, client_reference_number VARCHAR(255) UNIQUE, fund_number VARCHAR(255), security_id VARCHAR(255), trade_date DATE, settle_date DATE, quantity DECIMAL(19, 4), price DECIMAL(19, 4), principal DECIMAL(19, 4), net_amount DECIMAL(19, 4), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
app.db.ddl.create-trade-exceptions-table=CREATE TABLE trade_exceptions (id INT AUTO_INCREMENT PRIMARY KEY, client_reference_number VARCHAR(255), error_type VARCHAR(20) NOT NULL, failed_trade_json BLOB, failure_reason VARCHAR(1000), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
app.db.ddl.create-user-table=CREATE TABLE app_user (id INT AUTO_INCREMENT PRIMARY KEY, username VARCHAR(255) NOT NULL UNIQUE, password VARCHAR(255) NOT NULL, roles VARCHAR(255) NOT NULL)
app.db.ddl.create-entitlements-table=CREATE TABLE user_fund_entitlements (id INT AUTO_INCREMENT PRIMARY KEY, user_id INT NOT NULL, fund_number VARCHAR(255) NOT NULL, FOREIGN KEY (user_id) REFERENCES app_user(id))
app.db.ddl.create-json-docs-index=CREATE INDEX idx_json_docs_created_at ON json_docs(created_at)
app.db.ddl.create-trade-details-client-ref-index=CREATE INDEX idx_trade_details_client_ref ON trade_details(client_reference_number)
app.db.ddl.create-trade-exceptions-client-ref-index=CREATE INDEX idx_trade_ex_client_ref ON trade_exceptions(client_reference_number)
app.db.ddl.create-trade-details-created-at-index=CREATE INDEX idx_trade_details_created_at ON trade_details(created_at)
